!function(n,a,e){function t(t){function u(n){var e,t=n.children(),o=t.length;for(e=0;o>e;e++){var s=a(t[e]),h=s.children("ul");h.length&&(r(s,i),!f.expand&&h.hide(),r(s,f.expand&&c||l),u(h))}}function h(n,a){var t=e.isUndefined(a)?n.hasClass(l):a,o=n.children("ul");o.length&&n.removeClass(t&&l||c),o.length&&r(n,t&&c||l),t&&o.slideDown()||o.slideUp()}function g(n){for(var e=n.parents("li"),t=e.length,o=0;t>o;)h(a(e[o++]),!0)}function p(n){return a('[href="'+n+'"]')}var f=a.extend({},s,t);return function(){var e,t=o.hash,i=this,l=i.$navigator,c=l.children(f.selector),s=c.length;for(r(c,"navigator-collapses"),e=0;s>e;e++)u(a(c[e]));i.$navigatorWrap.on("click",".navigator-collapse > a, .navigator-collapse > p",function(n){var e=a(n.currentTarget),o=e.attr("href");o&&t!==o||(h(a(n.currentTarget).parent()),n.stopPropagation())}),i.$container.on("turnPrev",function(){h(c.find(".navigator-collapse > .selected").parent(),!0)}),i.$container.on("turnNext",function(){h(c.find(".navigator-collapse > .selected").parent(),!0)}),a(n).on("hashchange",function(){t=o.hash,g(p(t))}),g(p(t))}}var o=n.location,r=e.addClassName,i="navigator-collapse",l=i+"--close",c=i+"--open",s={selector:"ul",expand:!0};e.potion.collapseNavigator=function(n){var a=this,e=t(n);a.config.navigatorCallbackQueue.push({success:e})}}(window,jQuery,Magicbook);