!function(n,r){if(!n.document)throw new Error("magicbook requires a window with a document");"object"==typeof module&&"object"==typeof module.exports?module.exports=r(require("jquery"),n):"function"==typeof define&&define.amd?define(["jquery"],r($,n)):r(n.jQuery,n)}("undefined"!=typeof window?window:this,function(n,r){function t(n,r){return U.call(n)===r}function e(n){return t(n,"[object Function]")}function o(n){return t(n,"[object String]")}function a(n){return t(n,"[object Array]")}function i(n){return t(n,"[object Number]")}function c(n){return"undefined"==typeof n}function u(){var n=w.body;return n.scrollHeight-n.clientHeight>0}function l(n){return null===n||c(n)?[]:a(n)&&n||[n]}function s(n,r,t){return n&&r&&n[r]||t}function f(n,r){return{}.hasOwnProperty.call(n,r)}function d(r,t){r&&n.get(r).success(function(n){t&&e(t.success)&&t.success(n)}).fail(function(n){t&&e(t.fail)&&t.fail(n)}).always(function(){t&&e(t["finally"])&&t["finally"]()})}function p(r,t){var e=n(r);e&&!e.hasClass(t)&&e.addClass(t)}function g(){return C.random().toString(36).substr(2)}function v(n,r,t,o){var i,c,u,l=!1;if(!a(n))return l;for(i=0,c=n.length;c>i;i++)u=s(n[i],r),e(u)&&(l=!0,u.apply(t,o));return l}function h(n,r){p(n,y+r)}function m(n,r){n.after(r),n.remove(),r.append(n)}var b={title:"magicbook - An lightweight and scalable docs system for markdown, text or other.",container:"",navigator:"",content:"",navigatorUrl:"navigator.md",homeUrl:"README.md",baseUrl:"",urlArgs:"",parseFilters:[],navigatorCallbackQueue:[],routeCallbackQueue:[]},y="magicbook-",k=r.location,w=r.document,C=r.Math,$=Object.prototype,U=$.toString,j=r.Magicbook=function A(t){function e(){var r,t,e,o=c.container,a=c.navigator,u=c.content,l=n('<div class="magicbook-navigator-wrap"></div>'),s=n('<div class="magicbook-content-wrap"></div>');a||u?(a&&(t=n(a),t.length&&(h(t,"navigator"),m(t,l))),u&&(e=n(u),e.length&&(h(e,"content"),m(e,s)))):(r=n(o),r.length||(r=n('<div class="magicbook-container"></div>'),n(w.body).prepend(r)),h(r,"container"),t=n('<div class="magicbook-navigator"></div>'),e=n('<div class="magicbook-content"></div>'),l.append(t),s.append(e),r.append(l).append(s)),i.$container=r,i.$navigatorWrap=l,i.$contentWrap=s,i.$navigator=t,i.$content=e}function o(){var n=i.normalizeUrl(c.navigatorUrl),r=c.navigatorCallbackQueue;n&&(v(r,"prepare",i),d(n,{success:function(n){var t=i.parse(n);i.$navigator&&i.$navigator.empty().append(t),v(r,"success",i,[{origin:n,result:t}])},fail:function(n){v(r,"fail",i,[n])||i.$navigator&&i.$navigator.empty().append('<div class="magicbook-navigator__error magicbook-error">navigator not found</div>')},"finally":function(){v(r,"finally",i)}}))}function a(r){var t,e,o;for(t=0,e=r.length;e>t;t++)o=n(r[t]),o.attr("src",i.relativeCurrentUrl(o.attr("src")))}if(!(this instanceof A))return new A(t);var i=this,c=i.config=n.extend({},b,t);c.parseFilters=l(c.parseFilters),c.navigatorCallbackQueue=l(c.navigatorCallbackQueue),c.routeCallbackQueue=l(c.routeCallbackQueue),c.navigatorCallbackQueue.unshift({success:function(){a(i.$navigatorWrap.find("img"))}}),c.routeCallbackQueue.unshift({success:function(){a(i.$contentWrap.find("img"))}}),i.handlers={},i.handlersCount=0,i.handler("initNavigator",o,{priority:1}),i.handler("initContent",function(){i.route()},{priority:1}),n(r).on("hashchange",function(){i.route(k.hash)}),w.title=c.title,e()},Q=j.potion=j.prototype;Q.parser=function(n){return n},Q.parse=function(n){var r,t,o=this,a=o.config.parseFilters,i=a.length;for(r=0;i>r;r++){var c=a[r],u=c.before,l=c.after;e(u)&&(t=u.call(o,n)),t=o.parser(t),e(c.after)&&(t=l.call(o,t))}return t&&t||o.parser(n)},Q.route=function(n,r){var t=this,e=o(n)&&n||k.hash||t.config.homeUrl;e=t.normalizeUrl(e),t.render(e,r)},Q.render=function(n,r){var t=this,e=t.config.routeCallbackQueue,o=l(r);n&&(v(e,"prepare",t),v(o,"prepare",t),d(n,{success:function(n){var r=t.parse(n);t.$content&&t.$content.empty().append(r),v(e,"success",t,[{origin:n,result:r}]),v(o,"success",t,[{origin:n,result:r}])},fail:function(n){v(e,"fail",t,[n])||v(o,"fail",t,[n])||t.$content&&t.$content.empty().append('<div class="magicbook-content__error magicbook-error">content not found</div>')},"finally":function(){v(e,"finally",t),v(o,"finally",t)}}))},Q.normalizeUrl=function(n){if(!n)return n;var r=this,t=r.config,e=t.urlArgs,a=t.baseUrl+n.replace(/^#/,"");return e&&o(e)&&(a+=(-1===a.indexOf("?")?"?":"&")+e),a},Q.relativeCurrentUrl=function(n){var r=this,t=k.hash||r.config.homeUrl,e=t||"";return!t&&!n||!o(t)||n&&!o(n)?n||"":-1!==n.search(/\:\/\//)?n:(e=e.replace(/\#/,"").replace(/\/$/,""),e=e+(t&&"/../"||"")+(n||""),r.normalizeUrl(e))},Q.handler=function(r,t,e){var a=this,i=a.handlers;if(r&&o(r)&&!t&&!e)return i[r];var c=i[r],u={order:c&&c.order||a.handlersCount++,name:r,action:t,options:n.extend({priority:2},e)};i[r]=u},Q.show=function(){var n,r,t=this,o=t.handlers,a=[];for(var i in o){if(!f(o,i))return;var c=o[i],u=c.options.priority;for(n=0,r=a.length;r>n;n++){var l=a[n],s=l.options.priority;if(s>u||u===s&&c.order<l.order)break}a.splice(n,0,c)}for(n=0,r=a.length;r>n;n++){var d=a[n].action;e(d)&&d.call(this)}},Q.getCurrentDocUrl=function(){var n=this,r=k.hash||n.config.homeUrl;return r.replace(/^#/,"")},Q.moveTo=function(r){var t=this,e=n.extend({duration:500,gap:0},r),o=n(e.selector).offset(),a=o&&o.top-e.gap||0;(u()&&n(w.body)||t.$contentWrap).stop().animate({scrollTop:a},e.duration)};var x={};return j.markdown=function(n,r){var t=x[n]||j;return t(r)},j.customizeMarkdown=function(n,r){x[n]=r},j.toStringEqual=t,j.isFunction=e,j.isString=o,j.isArray=a,j.isNumber=i,j.isUndefined=c,j.isBodyScroller=u,j.parseArray=l,j.getPropertyByDefaultValue=s,j.hasOwnProperty=f,j.requestGet=d,j.addClassName=p,j.randomString=g,"object"==typeof module&&"object"==typeof module.exports||"function"==typeof define&&define.amd?j:void 0});