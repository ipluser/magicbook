!function(n,r){function t(n,r){return C.call(n)===r}function a(n){return t(n,"[object Function]")}function e(n){return t(n,"[object String]")}function o(n){return t(n,"[object Array]")}function i(n){return t(n,"[object Number]")}function c(n){return"undefined"==typeof n}function u(n){return null===n||c(n)?[]:o(n)&&n||[n]}function l(n,r,t){return n&&r&&n[r]||t}function s(n,r){return{}.hasOwnProperty.call(n,r)}function f(n,t){n&&r.get(n).success(function(n){t&&a(t.success)&&t.success(n)}).fail(function(n){t&&a(t.fail)&&t.fail(n)}).always(function(){t&&a(t["finally"])&&t["finally"]()})}function g(n,t){var a=r(n);a&&!a.hasClass(t)&&a.addClass(t)}function d(n,r,t,e){var i,c,u,s=!1;if(!o(n))return s;for(i=0,c=n.length;c>i;i++)u=l(n[i],r),a(u)&&(s=!0,u.apply(t,e));return s}function p(n,r){g(n,m+r)}function v(n,r){n.after(r),n.remove(),r.append(n)}var h={title:"magicbook - An lightweight and scalable docs system for markdown, text or other.",container:"",navigator:"",content:"",navigatorUrl:"navigator.md",homeUrl:"README.md",baseUrl:"",urlArgs:"",debug:!1,parseFilters:[],navigatorCallbackQueue:[],routeCallbackQueue:[]},m="magicbook-",b=n.location,y=n.document,k=Object.prototype,C=k.toString,U=n.Magicbook=function Q(t){function a(){var n,t,a,e=c.container,o=c.navigator,u=c.content,l=r('<div class="magicbook-navigator-wrap"></div>'),s=r('<div class="magicbook-content-wrap"></div>');o||u?(o&&(t=r(o),t.length&&(p(t,"navigator"),v(t,l))),u&&(a=r(u),a.length&&(p(a,"content"),v(a,s)))):(n=r(e),n.length||(n=r('<div class="magicbook-container"></div>'),r("body").prepend(n)),p(n,"container"),t=r('<div class="magicbook-navigator"></div>'),a=r('<div class="magicbook-content"></div>'),l.append(t),s.append(a),n.append(l).append(s)),i.$container=n,i.$navigatorWrap=l,i.$contentWrap=s,i.$navigator=t,i.$content=a}function e(n){var t,a,e;for(t=0,a=n.length;a>t;t++)e=r(n[t]),e.attr("src",i.relativeCurrentUrl(e.attr("src")))}function o(){var n=i.normalizeUrl(c.navigatorUrl),r=c.navigatorCallbackQueue;n&&f(n,{success:function(n){var t=i.parse(n);i.$navigator&&i.$navigator.empty().append(t),d(r,"success",i,[{origin:n,result:t}])},fail:function(n){d(r,"fail",i,[n])||i.$navigator&&i.$navigator.empty().append('<div class="magicbook-navigator__error magicbook-error">navigator not found</div>')},"finally":function(){d(r,"finally",i)}})}if(!(this instanceof Q))return new Q(t);var i=this,c=i.config=r.extend({},h,t);c.parseFilters=u(c.parseFilters),c.navigatorCallbackQueue=u(c.navigatorCallbackQueue),c.routeCallbackQueue=u(c.routeCallbackQueue),c.navigatorCallbackQueue.unshift({success:function(){e(i.$navigatorWrap.find("img"))}}),c.routeCallbackQueue.unshift({success:function(){e(i.$contentWrap.find("img"))}}),i.handlers={},i.handlersCount=0,i.handler("drawNavigator",o,{priority:1}),i.handler("drawContent",function(){i.route()},{priority:1}),n.onhashchange=function(){i.route(b.hash)},y.title=c.title,a()},$=U.potion=U.prototype;$.parser=function(n){return n},$.parse=function(n){var r,t,e=this,o=e.config.parseFilters,i=o.length;for(r=0;i>r;r++){var c=o[r],u=c.before,l=c.after;a(u)&&(t=u.call(e,n)),t=e.parser(t),a(c.after)&&(t=l.call(e,t))}return t&&t||e.parser(n)},$.route=function(n,r){var t=this,a=e(n)&&n||b.hash||t.config.homeUrl;a=t.normalizeUrl(a),t.render(a,r)},$.render=function(n,r){var t=this,a=t.config.routeCallbackQueue,e=u(r);n&&f(n,{success:function(n){var r=t.parse(n);t.$content&&t.$content.empty().append(r),d(a,"success",t,[{origin:n,result:r}]),d(e,"success",t,[{origin:n,result:r}])},fail:function(n){d(a,"fail",t,[n])||d(e,"fail",t,[n])||t.$content&&t.$content.empty().append('<div class="magicbook-content__error magicbook-error">content not found</div>')},"finally":function(){d(a,"finally",t),d(e,"finally",t)}})},$.normalizeUrl=function(n){if(!n)return n;var r=this,t=r.config,a=t.urlArgs,o=t.baseUrl+n.replace(/^#/,"");return a&&e(a)&&(o+=(-1===o.indexOf("?")?"?":"&")+a),o},$.relativeCurrentUrl=function(n){var r=this,t=b.hash||r.config.homeUrl,a=t||"";return!t&&!n||!e(t)||n&&!e(n)?n||"":-1!==n.search(/\:\/\//)?n:(a=a.replace(/\#/,"").replace(/\/$/,""),a=a+(t&&"/../"||"")+(n||""),r.normalizeUrl(a))},$.handler=function(n,t,a){var o=this,i=o.handlers;if(n&&e(n)&&!t&&!a)return i[n];var c=i[n],u={order:c&&c.order||o.handlersCount++,name:n,action:t,options:r.extend({priority:2},a)};i[n]=u},$.show=function(){var n,r,t=this,e=t.handlers,o=[];for(var i in e){if(!s(e,i))return;var c=e[i],u=c.options.priority;for(n=0,r=o.length;r>n;n++){var l=o[n],f=l.options.priority;if(f>u||u===f&&c.order<l.order)break}o.splice(n,0,c)}for(n=0,r=o.length;r>n;n++){var g=o[n].action;a(g)&&g.call(this)}},$.getCurrentDocUrl=function(){var n=this,r=b.hash||n.config.homeUrl;return r.replace(/^#/,"")};var w={};U.markdown=function(n,r){var t=w[n]||U;return t(r)},U.customizeMarkdown=function(n,r){w[n]=r},U.toStringEqual=t,U.isFunction=a,U.isString=e,U.isArray=o,U.isNumber=i,U.isUndefined=c,U.parseArray=u,U.getPropertyByDefaultValue=l,U.hasOwnProperty=s,U.requestGet=f,U.addClassName=g}(window,jQuery);