!function(n,r){function t(n,r){return U.call(n)===r}function e(n){return t(n,"[object Function]")}function a(n){return t(n,"[object String]")}function o(n){return t(n,"[object Array]")}function i(n){return t(n,"[object Number]")}function c(n){return"undefined"==typeof n}function l(){return C.scrollHeight-C.clientHeight>0}function u(n){return null===n||c(n)?[]:o(n)&&n||[n]}function s(n,r,t){return n&&r&&n[r]||t}function f(n,r){return{}.hasOwnProperty.call(n,r)}function g(n,t){n&&r.get(n).success(function(n){t&&e(t.success)&&t.success(n)}).fail(function(n){t&&e(t.fail)&&t.fail(n)}).always(function(){t&&e(t["finally"])&&t["finally"]()})}function p(n,t){var e=r(n);e&&!e.hasClass(t)&&e.addClass(t)}function d(n,r,t,a){var i,c,l,u=!1;if(!o(n))return u;for(i=0,c=n.length;c>i;i++)l=s(n[i],r),e(l)&&(u=!0,l.apply(t,a));return u}function v(n,r){p(n,b+r)}function h(n,r){n.after(r),n.remove(),r.append(n)}var m={title:"magicbook - An lightweight and scalable docs system for markdown, text or other.",container:"",navigator:"",content:"",navigatorUrl:"navigator.md",homeUrl:"README.md",baseUrl:"",urlArgs:"",parseFilters:[],navigatorCallbackQueue:[],routeCallbackQueue:[]},b="magicbook-",y=n.location,k=n.document,C=k.body,$=Object.prototype,U=$.toString,w=r(C),Q=n.Magicbook=function F(t){function e(){var n,t,e,a=c.container,o=c.navigator,l=c.content,u=r('<div class="magicbook-navigator-wrap"></div>'),s=r('<div class="magicbook-content-wrap"></div>');o||l?(o&&(t=r(o),t.length&&(v(t,"navigator"),h(t,u))),l&&(e=r(l),e.length&&(v(e,"content"),h(e,s)))):(n=r(a),n.length||(n=r('<div class="magicbook-container"></div>'),r("body").prepend(n)),v(n,"container"),t=r('<div class="magicbook-navigator"></div>'),e=r('<div class="magicbook-content"></div>'),u.append(t),s.append(e),n.append(u).append(s)),i.$container=n,i.$navigatorWrap=u,i.$contentWrap=s,i.$navigator=t,i.$content=e}function a(){var n=i.normalizeUrl(c.navigatorUrl),r=c.navigatorCallbackQueue;n&&g(n,{success:function(n){var t=i.parse(n);i.$navigator&&i.$navigator.empty().append(t),d(r,"success",i,[{origin:n,result:t}])},fail:function(n){d(r,"fail",i,[n])||i.$navigator&&i.$navigator.empty().append('<div class="magicbook-navigator__error magicbook-error">navigator not found</div>')},"finally":function(){d(r,"finally",i)}})}function o(n){var t,e,a;for(t=0,e=n.length;e>t;t++)a=r(n[t]),a.attr("src",i.relativeCurrentUrl(a.attr("src")))}if(!(this instanceof F))return new F(t);var i=this,c=i.config=r.extend({},m,t);c.parseFilters=u(c.parseFilters),c.navigatorCallbackQueue=u(c.navigatorCallbackQueue),c.routeCallbackQueue=u(c.routeCallbackQueue),c.navigatorCallbackQueue.unshift({success:function(){o(i.$navigatorWrap.find("img"))}}),c.routeCallbackQueue.unshift({success:function(){o(i.$contentWrap.find("img"))}}),i.handlers={},i.handlersCount=0,i.handler("initNavigator",a,{priority:1}),i.handler("initContent",function(){i.route()},{priority:1}),r(n).on("hashchange",function(){i.route(y.hash)}),k.title=c.title,e()},A=Q.potion=Q.prototype;A.parser=function(n){return n},A.parse=function(n){var r,t,a=this,o=a.config.parseFilters,i=o.length;for(r=0;i>r;r++){var c=o[r],l=c.before,u=c.after;e(l)&&(t=l.call(a,n)),t=a.parser(t),e(c.after)&&(t=u.call(a,t))}return t&&t||a.parser(n)},A.route=function(n,r){var t=this,e=a(n)&&n||y.hash||t.config.homeUrl;e=t.normalizeUrl(e),t.render(e,r)},A.render=function(n,r){var t=this,e=t.config.routeCallbackQueue,a=u(r);n&&g(n,{success:function(n){var r=t.parse(n);t.$content&&t.$content.empty().append(r),d(e,"success",t,[{origin:n,result:r}]),d(a,"success",t,[{origin:n,result:r}])},fail:function(n){d(e,"fail",t,[n])||d(a,"fail",t,[n])||t.$content&&t.$content.empty().append('<div class="magicbook-content__error magicbook-error">content not found</div>')},"finally":function(){d(e,"finally",t),d(a,"finally",t)}})},A.normalizeUrl=function(n){if(!n)return n;var r=this,t=r.config,e=t.urlArgs,o=t.baseUrl+n.replace(/^#/,"");return e&&a(e)&&(o+=(-1===o.indexOf("?")?"?":"&")+e),o},A.relativeCurrentUrl=function(n){var r=this,t=y.hash||r.config.homeUrl,e=t||"";return!t&&!n||!a(t)||n&&!a(n)?n||"":-1!==n.search(/\:\/\//)?n:(e=e.replace(/\#/,"").replace(/\/$/,""),e=e+(t&&"/../"||"")+(n||""),r.normalizeUrl(e))},A.handler=function(n,t,e){var o=this,i=o.handlers;if(n&&a(n)&&!t&&!e)return i[n];var c=i[n],l={order:c&&c.order||o.handlersCount++,name:n,action:t,options:r.extend({priority:2},e)};i[n]=l},A.show=function(){var n,r,t=this,a=t.handlers,o=[];for(var i in a){if(!f(a,i))return;var c=a[i],l=c.options.priority;for(n=0,r=o.length;r>n;n++){var u=o[n],s=u.options.priority;if(s>l||l===s&&c.order<u.order)break}o.splice(n,0,c)}for(n=0,r=o.length;r>n;n++){var g=o[n].action;e(g)&&g.call(this)}},A.getCurrentDocUrl=function(){var n=this,r=y.hash||n.config.homeUrl;return r.replace(/^#/,"")},A.moveTo=function(n){var t=this,e=r.extend({duration:500,gap:0},n),a=r(e.selector).offset(),o=a&&a.top-e.gap||0;(l()&&w||t.$contentWrap).stop().animate({scrollTop:o},e.duration)};var j={};Q.markdown=function(n,r){var t=j[n]||Q;return t(r)},Q.customizeMarkdown=function(n,r){j[n]=r},Q.toStringEqual=t,Q.isFunction=e,Q.isString=a,Q.isArray=o,Q.isNumber=i,Q.isUndefined=c,Q.isBodyScroller=l,Q.parseArray=u,Q.getPropertyByDefaultValue=s,Q.hasOwnProperty=f,Q.requestGet=g,Q.addClassName=p}(window,jQuery);