!function(n,r,a){function o(n,r){return p.call(n)===r}function t(n){return o(n,"[object Function]")}function i(n){return o(n,"[object String]")}function e(n){return o(n,"[object Array]")}function c(n){return null===n||n===a?[]:e(n)&&n||[n]}function u(n,r,a){return n&&r&&n[r]||a}function l(n,r){return{}.hasOwnProperty.call(n,r)}function s(n,a){n&&r.get(n).success(function(n){a&&t(a.success)&&a.success(n)}).fail(function(n){a&&t(a.fail)&&a.fail(n)}).always(function(){a&&t(a["finally"])&&a["finally"]()})}function f(n,r,a,o){var i,c,l,s=!1;if(!e(n))return s;for(i=0,c=n.length;c>i;i++)l=u(n[i],r),t(l)&&(s=!0,l.apply(a,o));return s}var v={container:"",navigator:"",content:"",navigatorUrl:"navigator.md",homeUrl:"README.md",baseUrl:"",urlArgs:"",debug:!1,navigatorCallbackQueue:[],routeCallbackQueue:[]},d=n.location,g=Object.prototype,p=g.toString,h=n.Magicbook=function y(a){function o(){var n=t.normalizeUrl(i.navigatorUrl),r=i.navigatorCallbackQueue;n&&s(n,{success:function(n){var a=t.parser(n);t.$navigator.empty().append(t.parser(n)),f(r,"success",t,[{origin:n,result:a}])},fail:function(n){f(r,"fail",t,[n])||t.$navigator.empty().append('<div class="magicbook-navigator__error magicbook-error">navigator not found</div>')},"finally":function(){f(r,"finally",t)}})}if(!(this instanceof y))return new y(a);var t=this,i=t.config=r.extend({},v,a);i.navigatorCallbackQueue=c(i.navigatorCallbackQueue),i.routeCallbackQueue=c(i.routeCallbackQueue);var e=t.$container=i.container&&r(i.container)||r('<div class="magicbook-container"></div>'),u=t.$navigatorWrap=r('<div class="magicbook-navigator-wrap"></div>'),l=t.$navigator=i.navigator&&r(i.navigator)||r('<div class="magicbook-navigator"></div>'),g=t.$contentWrap=r('<div class="magicbook-content-wrap"></div>'),p=t.$content=i.content&&r(i.content)||r('<div class="magicbook-content"></div>');!i.navigator&&u.append(l),!i.content&&g.append(p),!i.container&&r("body").append(e),e.append(u).append(g),t.handlers={},t.handlersCount=0,t.handler("drawNavigator",o,{priority:1}),t.handler("drawContent",function(){t.route()},{priority:1}),n.onhashchange=function(){t.route(d.hash)}},b=h.prototype;b.parser=function(n){return n},b.route=function(n,r){var a=this,o=i(n)&&n||d.hash||a.config.homeUrl;o=a.normalizeUrl(o),a.render(o,r)},b.render=function(n,r){var a=this,o=a.config.routeCallbackQueue,t=c(r);n&&s(n,{success:function(n){var r=a.parser(n);a.$content.empty().append(r),f(o,"success",a,[{origin:n,result:r}]),f(t,"success",a,[{origin:n,result:r}])},fail:function(n){f(o,"fail",a,[n])||f(t,"fail",a,[n])||a.$content.empty().append('<div class="magicbook-content__error magicbook-error">content not found</div>')},"finally":function(){f(o,"finally",a),f(t,"finally",a)}})},b.normalizeUrl=function(n){if(!n)return n;var r=this,a=r.config,o=a.urlArgs,t=a.baseUrl+n.replace(/^#/,"");return o&&i(o)&&(t+=(-1===t.indexOf("?")?"?":"&")+o),t},b.handler=function(n,a,o){var t=this,e=t.handlers;if(n&&i(n)&&!a&&!o)return e[n];var c=e[n],u={order:c&&c.order||t.handlersCount++,name:n,action:a,options:r.extend({priority:2},o)};e[n]=u},b.show=function(){var n,r,a=this,o=a.handlers,i=[];for(var e in o){if(!l(o,e))return;var c=o[e],u=c.options.priority;for(n=0,r=i.length;r>n;n++){var s=i[n],f=s.options.priority;if(f>u||u===f&&c.order<s.order)break}i.splice(n,0,c)}for(n=0,r=i.length;r>n;n++){var v=i[n].action;t(v)&&v.call(this)}}}(window,jQuery);