!function(n,r){function a(n,r,a,t){var o,e,i,c=!1;if(!p(n))return c;for(o=0,e=n.length;e>o;o++)i=b(n[o],r),d(i)&&(c=!0,i.apply(a,t));return c}function t(n,r){C(n,i+r)}function o(n,r){n.after(r),n.remove(),r.append(n)}var e={container:"",navigator:"",content:"",navigatorUrl:"navigator.md",homeUrl:"README.md",baseUrl:"",urlArgs:"",debug:!1,navigatorCallbackQueue:[],routeCallbackQueue:[]},i="magicbook-",c=n.location,u=Object.prototype,l=u.toString,s=n.Magicbook=function U(i){function u(){var n,a,e,i=g.container,c=g.navigator,u=g.content,l=r('<div class="magicbook-navigator-wrap"></div>'),s=r('<div class="magicbook-content-wrap"></div>');c||u?(c&&(a=r(c),a.length&&(t(a,"navigator"),o(a,l))),u&&(e=r(u),e.length&&(t(e,"content"),o(e,s)))):(n=r(i),n.length||(n=r('<div class="magicbook-container"></div>'),r("body").prepend(n)),t(n,"container"),a=r('<div class="magicbook-navigator"></div>'),e=r('<div class="magicbook-content"></div>'),l.append(a),s.append(e),n.append(l).append(s)),f.$container=n,f.$navigatorWrap=l,f.$contentWrap=s,f.$navigator=a,f.$content=e}function l(a){var t,o,e;for(t=0,o=a.length;o>t;t++)e=r(a[t]),e.attr("src",f.normalizeImageUrl(n.location.hash||f.config.homeUrl,e.attr("src")))}function s(){var n=f.normalizeUrl(g.navigatorUrl),r=g.navigatorCallbackQueue;n&&k(n,{success:function(n){var t=f.parser(n);f.$navigator&&f.$navigator.empty().append(f.parser(n)),a(r,"success",f,[{origin:n,result:t}])},fail:function(n){a(r,"fail",f,[n])||f.$navigator&&f.$navigator.empty().append('<div class="magicbook-navigator__error magicbook-error">navigator not found</div>')},"finally":function(){a(r,"finally",f)}})}if(!(this instanceof U))return new U(i);var f=this,g=f.config=r.extend({},e,i);u(),g.navigatorCallbackQueue=m(g.navigatorCallbackQueue),g.routeCallbackQueue=m(g.routeCallbackQueue),g.navigatorCallbackQueue.unshift({success:function(){l(f.$navigatorWrap.find("img"))}}),g.routeCallbackQueue.unshift({success:function(){l(f.$contentWrap.find("img"))}}),f.handlers={},f.handlersCount=0,f.handler("drawNavigator",s,{priority:1}),f.handler("drawContent",function(){f.route()},{priority:1}),n.onhashchange=function(){f.route(c.hash)}},f=s.potion=s.prototype;f.parser=function(n){return n},f.route=function(n,r){var a=this,t=v(n)&&n||c.hash||a.config.homeUrl;t=a.normalizeUrl(t),a.render(t,r)},f.render=function(n,r){var t=this,o=t.config.routeCallbackQueue,e=m(r);n&&k(n,{success:function(n){var r=t.parser(n);t.$content&&t.$content.empty().append(r),a(o,"success",t,[{origin:n,result:r}]),a(e,"success",t,[{origin:n,result:r}])},fail:function(n){a(o,"fail",t,[n])||a(e,"fail",t,[n])||t.$content&&t.$content.empty().append('<div class="magicbook-content__error magicbook-error">content not found</div>')},"finally":function(){a(o,"finally",t),a(e,"finally",t)}})},f.normalizeUrl=function(n){if(!n)return n;var r=this,a=r.config,t=a.urlArgs,o=a.baseUrl+n.replace(/^#/,"");return t&&v(t)&&(o+=(-1===o.indexOf("?")?"?":"&")+t),o},f.normalizeImageUrl=function(n,r){var a=this,t=n||"";return!n&&!r||!v(n)||r&&!v(r)?r||"":-1!==r.search(/\:\/\//)?r:(t=t.replace(/\#/,"").replace(/\/$/,""),t=t+(n&&"/../"||"")+(r||""),a.normalizeUrl(t))},f.handler=function(n,a,t){var o=this,e=o.handlers;if(n&&v(n)&&!a&&!t)return e[n];var i=e[n],c={order:i&&i.order||o.handlersCount++,name:n,action:a,options:r.extend({priority:2},t)};e[n]=c},f.show=function(){var n,r,a=this,t=a.handlers,o=[];for(var e in t){if(!y(t,e))return;var i=t[e],c=i.options.priority;for(n=0,r=o.length;r>n;n++){var u=o[n],l=u.options.priority;if(l>c||c===l&&i.order<u.order)break}o.splice(n,0,i)}for(n=0,r=o.length;r>n;n++){var s=o[n].action;d(s)&&s.call(this)}};var g=s.toStringEqual=function(n,r){return l.call(n)===r},d=s.isFunction=function(n){return g(n,"[object Function]")},v=s.isString=function(n){return g(n,"[object String]")},p=s.isArray=function(n){return g(n,"[object Array]")};s.isNumber=function(n){return g(n,"[object Number]")};var h=s.isUndefined=function(n){return"undefined"==typeof n},m=s.parseArray=function(n){return null===n||h(n)?[]:p(n)&&n||[n]},b=s.getPropertyByDefaultValue=function(n,r,a){return n&&r&&n[r]||a},y=s.hasOwnProperty=function(n,r){return{}.hasOwnProperty.call(n,r)},k=s.requestGet=function(n,a){n&&r.get(n).success(function(n){a&&d(a.success)&&a.success(n)}).fail(function(n){a&&d(a.fail)&&a.fail(n)}).always(function(){a&&d(a["finally"])&&a["finally"]()})},C=s.addClassName=function(n,a){var t=r(n);t&&!t.hasClass(a)&&t.addClass(a)},$={};s.markdown=function(n,r){var a=$[n]||s;return a(r)},s.customizeMarkdown=function(n,r){$[n]=r}}(window,jQuery);