!function(n,r){function a(n,r){return k.call(n)===r}function t(n){return a(n,"[object Function]")}function o(n){return a(n,"[object String]")}function e(n){return a(n,"[object Array]")}function i(n){return a(n,"[object Number]")}function c(n){return"undefined"==typeof n}function u(n){return null===n||c(n)?[]:e(n)&&n||[n]}function l(n,r,a){return n&&r&&n[r]||a}function s(n,r){return{}.hasOwnProperty.call(n,r)}function f(n,a){n&&r.get(n).success(function(n){a&&t(a.success)&&a.success(n)}).fail(function(n){a&&t(a.fail)&&a.fail(n)}).always(function(){a&&t(a["finally"])&&a["finally"]()})}function g(n,a){var t=r(n);t&&!t.hasClass(a)&&t.addClass(a)}function d(n,r,a,o){var i,c,u,s=!1;if(!e(n))return s;for(i=0,c=n.length;c>i;i++)u=l(n[i],r),t(u)&&(s=!0,u.apply(a,o));return s}function v(n,r){g(n,m+r)}function p(n,r){n.after(r),n.remove(),r.append(n)}var h={container:"",navigator:"",content:"",navigatorUrl:"navigator.md",homeUrl:"README.md",baseUrl:"",urlArgs:"",debug:!1,navigatorCallbackQueue:[],routeCallbackQueue:[]},m="magicbook-",b=n.location,y=Object.prototype,k=y.toString,C=n.Magicbook=function w(a){function t(){var n,a,t,o=c.container,e=c.navigator,u=c.content,l=r('<div class="magicbook-navigator-wrap"></div>'),s=r('<div class="magicbook-content-wrap"></div>');e||u?(e&&(a=r(e),a.length&&(v(a,"navigator"),p(a,l))),u&&(t=r(u),t.length&&(v(t,"content"),p(t,s)))):(n=r(o),n.length||(n=r('<div class="magicbook-container"></div>'),r("body").prepend(n)),v(n,"container"),a=r('<div class="magicbook-navigator"></div>'),t=r('<div class="magicbook-content"></div>'),l.append(a),s.append(t),n.append(l).append(s)),i.$container=n,i.$navigatorWrap=l,i.$contentWrap=s,i.$navigator=a,i.$content=t}function o(a){var t,o,e;for(t=0,o=a.length;o>t;t++)e=r(a[t]),e.attr("src",i.normalizeImageUrl(n.location.hash||i.config.homeUrl,e.attr("src")))}function e(){var n=i.normalizeUrl(c.navigatorUrl),r=c.navigatorCallbackQueue;n&&f(n,{success:function(n){var a=i.parser(n);i.$navigator&&i.$navigator.empty().append(i.parser(n)),d(r,"success",i,[{origin:n,result:a}])},fail:function(n){d(r,"fail",i,[n])||i.$navigator&&i.$navigator.empty().append('<div class="magicbook-navigator__error magicbook-error">navigator not found</div>')},"finally":function(){d(r,"finally",i)}})}if(!(this instanceof w))return new w(a);var i=this,c=i.config=r.extend({},h,a);c.navigatorCallbackQueue=u(c.navigatorCallbackQueue),c.routeCallbackQueue=u(c.routeCallbackQueue),c.navigatorCallbackQueue.unshift({success:function(){o(i.$navigatorWrap.find("img"))}}),c.routeCallbackQueue.unshift({success:function(){o(i.$contentWrap.find("img"))}}),i.handlers={},i.handlersCount=0,i.handler("drawNavigator",e,{priority:1}),i.handler("drawContent",function(){i.route()},{priority:1}),n.onhashchange=function(){i.route(b.hash)},t()},$=C.potion=C.prototype;$.parser=function(n){return n},$.route=function(n,r){var a=this,t=o(n)&&n||b.hash||a.config.homeUrl;t=a.normalizeUrl(t),a.render(t,r)},$.render=function(n,r){var a=this,t=a.config.routeCallbackQueue,o=u(r);n&&f(n,{success:function(n){var r=a.parser(n);a.$content&&a.$content.empty().append(r),d(t,"success",a,[{origin:n,result:r}]),d(o,"success",a,[{origin:n,result:r}])},fail:function(n){d(t,"fail",a,[n])||d(o,"fail",a,[n])||a.$content&&a.$content.empty().append('<div class="magicbook-content__error magicbook-error">content not found</div>')},"finally":function(){d(t,"finally",a),d(o,"finally",a)}})},$.normalizeUrl=function(n){if(!n)return n;var r=this,a=r.config,t=a.urlArgs,e=a.baseUrl+n.replace(/^#/,"");return t&&o(t)&&(e+=(-1===e.indexOf("?")?"?":"&")+t),e},$.normalizeImageUrl=function(n,r){var a=this,t=n||"";return!n&&!r||!o(n)||r&&!o(r)?r||"":-1!==r.search(/\:\/\//)?r:(t=t.replace(/\#/,"").replace(/\/$/,""),t=t+(n&&"/../"||"")+(r||""),a.normalizeUrl(t))},$.handler=function(n,a,t){var e=this,i=e.handlers;if(n&&o(n)&&!a&&!t)return i[n];var c=i[n],u={order:c&&c.order||e.handlersCount++,name:n,action:a,options:r.extend({priority:2},t)};i[n]=u},$.show=function(){var n,r,a=this,o=a.handlers,e=[];for(var i in o){if(!s(o,i))return;var c=o[i],u=c.options.priority;for(n=0,r=e.length;r>n;n++){var l=e[n],f=l.options.priority;if(f>u||u===f&&c.order<l.order)break}e.splice(n,0,c)}for(n=0,r=e.length;r>n;n++){var g=e[n].action;t(g)&&g.call(this)}};var U={};C.markdown=function(n,r){var a=U[n]||C;return a(r)},C.customizeMarkdown=function(n,r){U[n]=r},C.toStringEqual=a,C.isFunction=t,C.isString=o,C.isArray=e,C.isNumber=i,C.isUndefined=c,C.parseArray=u,C.getPropertyByDefaultValue=l,C.hasOwnProperty=s,C.requestGet=f,C.addClassName=g}(window,jQuery);